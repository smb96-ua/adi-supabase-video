import{s as E,d as se,r as C,o as ie,a as de,t as ce,c as b,w as o,u as e,b as ve,e as v,f as l,I as P,g as $,h as F,i as d,j as G,k as y,l as I,m as fe,n as j,p as J,q as pe,v as me,x as _,y as K,z as W,A as D,F as ge,B as be,C as k,D as ke,E as ye,G as L,H as p,J as f,K as _e,L as X,M as h,N as we,S as Ce,T as M,O as B,P as Ve,Q as Se,R as Ie,_ as he}from"./index-CLs4vlUt.js";const U="series";async function Y(i={}){var x;let c=E.from(U).select("*");const u=((x=i.sort)==null?void 0:x.replace("-",""))||"created_at",m=i.sort?!i.sort.startsWith("-"):!1;c=c.order(u,{ascending:m});const{data:N,error:V}=await c;if(V)throw V;return N||[]}async function Ee(i){const{data:c,error:u}=await E.from(U).insert(i).select().single();if(u)throw u;return c}async function xe(i,c){const{data:u,error:m}=await E.from(U).update(c).eq("id",i).select().single();if(m)throw m;return u}async function Te(i){const{error:c}=await E.from(U).delete().eq("id",i);if(c)throw c}async function De(i){if(!i||i.trim()==="")return await Y();const{data:c,error:u}=await E.from(U).select("*").or("titulo.ilike.%".concat(i,"%,descripcion.ilike.%").concat(i,"%,genero.ilike.%").concat(i,"%,creador.ilike.%").concat(i,"%")).order("created_at",{ascending:!1});if(u)throw u;return c||[]}function Ue(i){const c=E.channel("series-changes").on("postgres_changes",{event:"*",schema:"public",table:U},u=>{i({action:u.eventType,record:u.new||u.old})}).subscribe();return()=>{E.removeChannel(c)}}const Ne={class:"empty-state"},Le=["src","alt"],Me={key:0,class:"creador"},Re={key:1,class:"estado"},$e={class:"detail-content"},Be=["src","alt"],Ae={class:"detail-meta"},ze={key:1,class:"creador-info"},Pe={key:2,class:"description"},Fe=se({__name:"SeriesPage",setup(i){const c=ve(),u=C([]),m=C(!0),N=C(""),V=C(!1),x=C(!1),S=C(null),s=C(null),r=C({titulo:"",descripcion:"",genero:"",anio:null,creador:"",estado:"",valoracion:null,poster:"",trailer:""});let A=null;ie(async()=>{await R(),A=Ue(ee)}),de(()=>{A&&A()});async function R(){m.value=!0;try{u.value=await Y()}catch(n){console.error("Error loading series:",n),g("Error al cargar series","danger")}finally{m.value=!1}}async function Z(){try{u.value=await De(N.value)}catch(n){console.error("Error searching:",n)}}async function q(n){await R(),n.target.complete()}function ee(n){var t;console.log("ðŸ”´ REALTIME - Cambio detectado en series"),console.log("AcciÃ³n:",n.action),console.log("Record:",n.record);const a=(t=n.action)==null?void 0:t.toLowerCase();if(a==="insert"||a==="create")u.value.some(T=>T.id===n.record.id)||(u.value=[n.record,...u.value]),g("Nueva serie aÃ±adida","success");else if(a==="update"){const w=u.value.findIndex(T=>T.id===n.record.id);w!==-1&&(u.value=[...u.value.slice(0,w),n.record,...u.value.slice(w+1)]),g("Serie actualizada","success")}else a==="delete"&&(u.value=u.value.filter(w=>w.id!==n.record.id),g("Serie eliminada","warning"))}function H(){S.value=null,Q(),V.value=!0}function le(n){S.value=n,r.value={titulo:n.titulo||"",descripcion:n.descripcion||"",genero:n.genero||"",anio:n.anio||null,creador:n.creador||"",estado:n.estado||"",valoracion:n.valoracion||null,poster:n.poster||"",trailer:n.trailer||""},V.value=!0}function z(){V.value=!1,S.value=null,Q()}function ae(n){s.value=n,x.value=!0}function O(){x.value=!1,s.value=null}function Q(){r.value={titulo:"",descripcion:"",genero:"",anio:null,creador:"",estado:"",valoracion:null,poster:"",trailer:""}}async function oe(){if(!r.value.titulo||!r.value.descripcion||!r.value.genero||!r.value.anio){g("TÃ­tulo, descripciÃ³n, gÃ©nero y aÃ±o son obligatorios","warning");return}const n={titulo:r.value.titulo,descripcion:r.value.descripcion,genero:r.value.genero,anio:Number(r.value.anio),creador:r.value.creador||void 0,estado:r.value.estado||void 0,valoracion:r.value.valoracion?Number(r.value.valoracion):void 0,poster:r.value.poster||void 0,trailer:r.value.trailer||void 0};try{S.value?(await xe(S.value.id,n),g("Serie actualizada","success")):(await Ee(n),g("Serie creada","success")),z(),await R()}catch(a){console.error("Error saving serie:",a),g((a==null?void 0:a.message)||"Error al guardar","danger")}}async function te(n){await(await Se.create({header:"Confirmar eliminaciÃ³n",message:'Â¿Eliminar "'.concat(n.titulo,'"?'),buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:async()=>{await ne(n)}}]})).present()}async function ne(n){try{await Te(n.id),g("Serie eliminada","success"),await R()}catch(a){console.error("Error deleting serie:",a),g("Error al eliminar","danger")}}function re(n){window.open(n,"_blank")}async function g(n,a){await(await ce.create({message:n,duration:2e3,color:a,position:"bottom"})).present()}async function ue(){await Ie(),c.push("/login")}return(n,a)=>(v(),b(e(Ve),null,{default:o(()=>[l(e(P),null,{default:o(()=>[l(e($),{color:"primary"},{default:o(()=>[l(e(F),null,{default:o(()=>[...a[11]||(a[11]=[d("Series",-1)])]),_:1}),l(e(G),{slot:"end"},{default:o(()=>[l(e(y),{onClick:H},{default:o(()=>[l(e(I),{slot:"icon-only",name:"add"})]),_:1}),l(e(y),{onClick:ue},{default:o(()=>[l(e(I),{slot:"icon-only",name:"log-out-outline"})]),_:1})]),_:1})]),_:1}),l(e($),null,{default:o(()=>[l(e(fe),{modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=t=>N.value=t),placeholder:"Buscar series...",onIonInput:Z,debounce:300},null,8,["modelValue"])]),_:1})]),_:1}),l(e(j),null,{default:o(()=>[l(e(pe),{slot:"fixed",onIonRefresh:q},{default:o(()=>[l(e(me))]),_:1}),J(_("div",Ne,[l(e(I),{name:"tv-outline",size:"large"}),a[13]||(a[13]=_("p",null,"No hay series",-1)),l(e(y),{onClick:H},{default:o(()=>[...a[12]||(a[12]=[d("AÃ±adir serie",-1)])]),_:1})],512),[[K,!m.value&&u.value.length===0]]),J(l(e(W),null,{default:o(()=>[(v(!0),D(ge,null,be(u.value,(t,w)=>(v(),b(e(k),{key:t.id||"serie-".concat(w)},{default:o(()=>[t.poster?(v(),b(e(ke),{key:0,slot:"start"},{default:o(()=>[_("img",{src:t.poster,alt:t.titulo||"Serie"},null,8,Le)]),_:2},1024)):(v(),b(e(ye),{key:1,slot:"start"},{default:o(()=>[l(e(I),{name:"tv-outline",size:"large"})]),_:1})),l(e(L),{onClick:T=>ae(t),style:{cursor:"pointer"}},{default:o(()=>[_("h2",null,f(t.titulo||"Sin tÃ­tulo"),1),_("p",null,f(t.genero||"Sin gÃ©nero")+" Â· "+f(t.anio||"Sin aÃ±o"),1),t.creador?(v(),D("p",Me,"Creador: "+f(t.creador),1)):p("",!0),t.estado?(v(),D("p",Re,f(t.estado),1)):p("",!0)]),_:2},1032,["onClick"]),l(e(y),{fill:"clear",slot:"end",onClick:T=>le(t)},{default:o(()=>[l(e(I),{slot:"icon-only",name:"create-outline",color:"primary"})]),_:1},8,["onClick"]),l(e(y),{fill:"clear",slot:"end",onClick:T=>te(t)},{default:o(()=>[l(e(I),{slot:"icon-only",name:"trash-outline",color:"danger"})]),_:1},8,["onClick"])]),_:2},1024))),128))]),_:1},512),[[K,!m.value&&u.value.length>0]]),l(e(_e),{"is-open":m.value,message:"Cargando..."},null,8,["is-open"]),l(e(X),{"is-open":V.value,onDidDismiss:z},{default:o(()=>[l(e(P),null,{default:o(()=>[l(e($),null,{default:o(()=>[l(e(F),null,{default:o(()=>[d(f(S.value?"Editar":"Nueva")+" Serie",1)]),_:1}),l(e(G),{slot:"end"},{default:o(()=>[l(e(y),{onClick:z},{default:o(()=>[...a[14]||(a[14]=[d("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(e(j),{class:"ion-padding"},{default:o(()=>[l(e(W),null,{default:o(()=>[l(e(k),null,{default:o(()=>[l(e(h),{label:"TÃ­tulo *","label-placement":"stacked",modelValue:r.value.titulo,"onUpdate:modelValue":a[1]||(a[1]=t=>r.value.titulo=t),placeholder:"Nombre de la serie"},null,8,["modelValue"])]),_:1}),l(e(k),null,{default:o(()=>[l(e(we),{label:"DescripciÃ³n *","label-placement":"stacked",modelValue:r.value.descripcion,"onUpdate:modelValue":a[2]||(a[2]=t=>r.value.descripcion=t),rows:3,placeholder:"Sinopsis"},null,8,["modelValue"])]),_:1}),l(e(k),null,{default:o(()=>[l(e(h),{label:"GÃ©nero *","label-placement":"stacked",modelValue:r.value.genero,"onUpdate:modelValue":a[3]||(a[3]=t=>r.value.genero=t),placeholder:"Ej: Drama, Comedia..."},null,8,["modelValue"])]),_:1}),l(e(k),null,{default:o(()=>[l(e(h),{label:"AÃ±o *","label-placement":"stacked",type:"number",modelValue:r.value.anio,"onUpdate:modelValue":a[4]||(a[4]=t=>r.value.anio=t),placeholder:"1900-2030"},null,8,["modelValue"])]),_:1}),l(e(k),null,{default:o(()=>[l(e(h),{label:"Creador","label-placement":"stacked",modelValue:r.value.creador,"onUpdate:modelValue":a[5]||(a[5]=t=>r.value.creador=t),placeholder:"Nombre del creador"},null,8,["modelValue"])]),_:1}),l(e(k),null,{default:o(()=>[l(e(Ce),{label:"Estado","label-placement":"stacked",modelValue:r.value.estado,"onUpdate:modelValue":a[6]||(a[6]=t=>r.value.estado=t),placeholder:"Seleccionar estado"},{default:o(()=>[l(e(M),{value:""},{default:o(()=>[...a[15]||(a[15]=[d("Sin especificar",-1)])]),_:1}),l(e(M),{value:"En emisiÃ³n"},{default:o(()=>[...a[16]||(a[16]=[d("En emisiÃ³n",-1)])]),_:1}),l(e(M),{value:"Finalizada"},{default:o(()=>[...a[17]||(a[17]=[d("Finalizada",-1)])]),_:1}),l(e(M),{value:"Cancelada"},{default:o(()=>[...a[18]||(a[18]=[d("Cancelada",-1)])]),_:1}),l(e(M),{value:"PrÃ³ximamente"},{default:o(()=>[...a[19]||(a[19]=[d("PrÃ³ximamente",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e(k),null,{default:o(()=>[l(e(h),{label:"ValoraciÃ³n (0-10)","label-placement":"stacked",type:"number",modelValue:r.value.valoracion,"onUpdate:modelValue":a[7]||(a[7]=t=>r.value.valoracion=t),placeholder:"0-10"},null,8,["modelValue"])]),_:1}),l(e(k),null,{default:o(()=>[l(e(h),{label:"Poster URL","label-placement":"stacked",type:"url",modelValue:r.value.poster,"onUpdate:modelValue":a[8]||(a[8]=t=>r.value.poster=t),placeholder:"https://..."},null,8,["modelValue"])]),_:1}),l(e(k),null,{default:o(()=>[l(e(h),{label:"Trailer URL","label-placement":"stacked",type:"url",modelValue:r.value.trailer,"onUpdate:modelValue":a[9]||(a[9]=t=>r.value.trailer=t),placeholder:"https://..."},null,8,["modelValue"])]),_:1})]),_:1}),l(e(y),{expand:"block",onClick:oe,class:"ion-margin-top"},{default:o(()=>[d(f(S.value?"Guardar Cambios":"Crear Serie"),1)]),_:1})]),_:1})]),_:1},8,["is-open"]),l(e(X),{"is-open":x.value,onDidDismiss:O},{default:o(()=>[l(e(P),null,{default:o(()=>[l(e($),null,{default:o(()=>[l(e(F),null,{default:o(()=>{var t;return[d(f((t=s.value)==null?void 0:t.titulo),1)]}),_:1}),l(e(G),{slot:"end"},{default:o(()=>[l(e(y),{onClick:O},{default:o(()=>[...a[20]||(a[20]=[d("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),s.value?(v(),b(e(j),{key:0,class:"ion-padding"},{default:o(()=>[_("div",$e,[s.value.poster?(v(),D("img",{key:0,src:s.value.poster,alt:s.value.titulo,class:"detail-poster"},null,8,Be)):p("",!0),_("h1",null,f(s.value.titulo),1),_("div",Ae,[s.value.genero?(v(),b(e(B),{key:0},{default:o(()=>[l(e(L),null,{default:o(()=>[d(f(s.value.genero),1)]),_:1})]),_:1})):p("",!0),s.value.anio?(v(),b(e(B),{key:1},{default:o(()=>[l(e(L),null,{default:o(()=>[d(f(s.value.anio),1)]),_:1})]),_:1})):p("",!0),s.value.estado?(v(),b(e(B),{key:2},{default:o(()=>[l(e(L),null,{default:o(()=>[d(f(s.value.estado),1)]),_:1})]),_:1})):p("",!0),s.value.valoracion?(v(),b(e(B),{key:3},{default:o(()=>[l(e(L),null,{default:o(()=>[d("â­ "+f(s.value.valoracion),1)]),_:1})]),_:1})):p("",!0)]),s.value.creador?(v(),D("p",ze,[a[21]||(a[21]=_("strong",null,"Creador:",-1)),d(" "+f(s.value.creador),1)])):p("",!0),s.value.descripcion?(v(),D("p",Pe,f(s.value.descripcion),1)):p("",!0),s.value.trailer?(v(),b(e(y),{key:3,expand:"block",onClick:a[10]||(a[10]=t=>re(s.value.trailer))},{default:o(()=>[l(e(I),{slot:"start",name:"play-outline"}),a[22]||(a[22]=d(" Ver Trailer ",-1))]),_:1})):p("",!0)])]),_:1})):p("",!0)]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),je=he(Fe,[["__scopeId","data-v-023c13cc"]]);export{je as default};
