import{s as D,d as ue,r as V,o as ie,a as se,t as de,c as g,w as a,u as e,b as ce,e as c,f as l,I as S,g as R,h as z,i as f,j as F,k as y,l as M,m as ve,n as G,p as J,q as fe,v as pe,x as k,y as K,z as O,A as U,F as me,B as ge,C as b,D as be,E as _e,G as N,H as _,J as v,K as ye,L as W,M as h,N as ke,O as $,P as we,Q as Ve,R as he,_ as Ce}from"./index-CLs4vlUt.js";const T="movies";async function X(s={}){var E;let d=D.from(T).select("*");const u=((E=s.sort)==null?void 0:E.replace("-",""))||"created_at",p=s.sort?!s.sort.startsWith("-"):!1;d=d.order(u,{ascending:p});const{data:P,error:C}=await d;if(C)throw C;return P||[]}async function Ie(s){const{data:d,error:u}=await D.from(T).insert(s).select().single();if(u)throw u;return d}async function Me(s,d){const{data:u,error:p}=await D.from(T).update(d).eq("id",s).select().single();if(p)throw p;return u}async function De(s){const{error:d}=await D.from(T).delete().eq("id",s);if(d)throw d}async function Ee(s){if(!s||s.trim()==="")return await X();const{data:d,error:u}=await D.from(T).select("*").or("titulo.ilike.%".concat(s,"%,descripcion.ilike.%").concat(s,"%,genero.ilike.%").concat(s,"%,director.ilike.%").concat(s,"%")).order("created_at",{ascending:!1});if(u)throw u;return d||[]}function xe(s){const d=D.channel("movies-changes").on("postgres_changes",{event:"*",schema:"public",table:T},u=>{s({action:u.eventType,record:u.new||u.old})}).subscribe();return()=>{D.removeChannel(d)}}const Te={class:"empty-state"},Pe=["src","alt"],Ue={key:0,class:"director"},Ne={class:"detail-content"},Le=["src","alt"],Re={class:"detail-meta"},$e={key:1,class:"director-info"},Ae={key:2,class:"description"},Be=ue({__name:"MoviesPage",setup(s){const d=ce(),u=V([]),p=V(!0),P=V(""),C=V(!1),E=V(!1),I=V(null),i=V(null),r=V({titulo:"",descripcion:"",genero:"",anio:null,director:"",duracion:null,valoracion:null,poster:"",trailer:""});let A=null;ie(async()=>{await L(),A=xe(q)}),se(()=>{A&&A()});async function L(){p.value=!0;try{u.value=await X()}catch(t){console.error("Error loading movies:",t),m("Error al cargar pelÃ­culas","danger")}finally{p.value=!1}}async function Y(){try{u.value=await Ee(P.value)}catch(t){console.error("Error searching:",t)}}async function Z(t){await L(),t.target.complete()}function q(t){var n;console.log("ðŸ”´ REALTIME - Cambio detectado en movies"),console.log("AcciÃ³n:",t.action),console.log("Record:",t.record);const o=(n=t.action)==null?void 0:n.toLowerCase();if(o==="insert"||o==="create")u.value.some(x=>x.id===t.record.id)||(u.value=[t.record,...u.value]),m("Nueva pelÃ­cula aÃ±adida","success");else if(o==="update"){const w=u.value.findIndex(x=>x.id===t.record.id);w!==-1&&(u.value=[...u.value.slice(0,w),t.record,...u.value.slice(w+1)]),m("PelÃ­cula actualizada","success")}else o==="delete"&&(u.value=u.value.filter(w=>w.id!==t.record.id),m("PelÃ­cula eliminada","warning"))}function j(){I.value=null,Q(),C.value=!0}function ee(t){I.value=t,r.value={titulo:t.titulo||"",descripcion:t.descripcion||"",genero:t.genero||"",anio:t.anio||null,director:t.director||"",duracion:t.duracion||null,valoracion:t.valoracion||null,poster:t.poster||"",trailer:t.trailer||""},C.value=!0}function B(){C.value=!1,I.value=null,Q()}function le(t){i.value=t,E.value=!0}function H(){E.value=!1,i.value=null}function Q(){r.value={titulo:"",descripcion:"",genero:"",anio:null,director:"",duracion:null,valoracion:null,poster:"",trailer:""}}async function ae(){if(!r.value.titulo||!r.value.descripcion||!r.value.genero||!r.value.anio){m("TÃ­tulo, descripciÃ³n, gÃ©nero y aÃ±o son obligatorios","warning");return}const t={titulo:r.value.titulo,descripcion:r.value.descripcion,genero:r.value.genero,anio:Number(r.value.anio),director:r.value.director||void 0,duracion:r.value.duracion?Number(r.value.duracion):void 0,valoracion:r.value.valoracion?Number(r.value.valoracion):void 0,poster:r.value.poster||void 0,trailer:r.value.trailer||void 0};try{I.value?(await Me(I.value.id,t),m("PelÃ­cula actualizada","success")):(await Ie(t),m("PelÃ­cula creada","success")),B(),await L()}catch(o){console.error("Error saving movie:",o),m((o==null?void 0:o.message)||"Error al guardar","danger")}}async function oe(t){await(await Ve.create({header:"Confirmar eliminaciÃ³n",message:'Â¿Eliminar "'.concat(t.titulo,'"?'),buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:async()=>{await te(t)}}]})).present()}async function te(t){try{await De(t.id),m("PelÃ­cula eliminada","success"),await L()}catch(o){console.error("Error deleting movie:",o),m("Error al eliminar","danger")}}function ne(t){window.open(t,"_blank")}async function m(t,o){await(await de.create({message:t,duration:2e3,color:o,position:"bottom"})).present()}async function re(){await he(),d.push("/login")}return(t,o)=>(c(),g(e(we),null,{default:a(()=>[l(e(S),null,{default:a(()=>[l(e(R),{color:"primary"},{default:a(()=>[l(e(z),null,{default:a(()=>[...o[11]||(o[11]=[f("PelÃ­culas",-1)])]),_:1}),l(e(F),{slot:"end"},{default:a(()=>[l(e(y),{onClick:j},{default:a(()=>[l(e(M),{slot:"icon-only",name:"add"})]),_:1}),l(e(y),{onClick:re},{default:a(()=>[l(e(M),{slot:"icon-only",name:"log-out-outline"})]),_:1})]),_:1})]),_:1}),l(e(R),null,{default:a(()=>[l(e(ve),{modelValue:P.value,"onUpdate:modelValue":o[0]||(o[0]=n=>P.value=n),placeholder:"Buscar pelÃ­culas...",onIonInput:Y,debounce:300},null,8,["modelValue"])]),_:1})]),_:1}),l(e(G),null,{default:a(()=>[l(e(fe),{slot:"fixed",onIonRefresh:Z},{default:a(()=>[l(e(pe))]),_:1}),J(k("div",Te,[l(e(M),{name:"film-outline",size:"large"}),o[13]||(o[13]=k("p",null,"No hay pelÃ­culas",-1)),l(e(y),{onClick:j},{default:a(()=>[...o[12]||(o[12]=[f("AÃ±adir pelÃ­cula",-1)])]),_:1})],512),[[K,!p.value&&u.value.length===0]]),J(l(e(O),null,{default:a(()=>[(c(!0),U(me,null,ge(u.value,(n,w)=>(c(),g(e(b),{key:n.id||"movie-".concat(w)},{default:a(()=>[n.poster?(c(),g(e(be),{key:0,slot:"start"},{default:a(()=>[k("img",{src:n.poster,alt:n.titulo||"PelÃ­cula"},null,8,Pe)]),_:2},1024)):(c(),g(e(_e),{key:1,slot:"start"},{default:a(()=>[l(e(M),{name:"film-outline",size:"large"})]),_:1})),l(e(N),{onClick:x=>le(n),style:{cursor:"pointer"}},{default:a(()=>[k("h2",null,v(n.titulo||"Sin tÃ­tulo"),1),k("p",null,v(n.genero||"Sin gÃ©nero")+" Â· "+v(n.anio||"Sin aÃ±o"),1),n.director?(c(),U("p",Ue,"Dir: "+v(n.director),1)):_("",!0)]),_:2},1032,["onClick"]),l(e(y),{fill:"clear",slot:"end",onClick:x=>ee(n)},{default:a(()=>[l(e(M),{slot:"icon-only",name:"create-outline",color:"primary"})]),_:1},8,["onClick"]),l(e(y),{fill:"clear",slot:"end",onClick:x=>oe(n)},{default:a(()=>[l(e(M),{slot:"icon-only",name:"trash-outline",color:"danger"})]),_:1},8,["onClick"])]),_:2},1024))),128))]),_:1},512),[[K,!p.value&&u.value.length>0]]),l(e(ye),{"is-open":p.value,message:"Cargando..."},null,8,["is-open"]),l(e(W),{"is-open":C.value,onDidDismiss:B},{default:a(()=>[l(e(S),null,{default:a(()=>[l(e(R),null,{default:a(()=>[l(e(z),null,{default:a(()=>[f(v(I.value?"Editar":"Nueva")+" PelÃ­cula",1)]),_:1}),l(e(F),{slot:"end"},{default:a(()=>[l(e(y),{onClick:B},{default:a(()=>[...o[14]||(o[14]=[f("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(e(G),{class:"ion-padding"},{default:a(()=>[l(e(O),null,{default:a(()=>[l(e(b),null,{default:a(()=>[l(e(h),{label:"TÃ­tulo *","label-placement":"stacked",modelValue:r.value.titulo,"onUpdate:modelValue":o[1]||(o[1]=n=>r.value.titulo=n),placeholder:"Nombre de la pelÃ­cula"},null,8,["modelValue"])]),_:1}),l(e(b),null,{default:a(()=>[l(e(ke),{label:"DescripciÃ³n *","label-placement":"stacked",modelValue:r.value.descripcion,"onUpdate:modelValue":o[2]||(o[2]=n=>r.value.descripcion=n),rows:3,placeholder:"Sinopsis"},null,8,["modelValue"])]),_:1}),l(e(b),null,{default:a(()=>[l(e(h),{label:"GÃ©nero *","label-placement":"stacked",modelValue:r.value.genero,"onUpdate:modelValue":o[3]||(o[3]=n=>r.value.genero=n),placeholder:"Ej: AcciÃ³n, Drama..."},null,8,["modelValue"])]),_:1}),l(e(b),null,{default:a(()=>[l(e(h),{label:"AÃ±o *","label-placement":"stacked",type:"number",modelValue:r.value.anio,"onUpdate:modelValue":o[4]||(o[4]=n=>r.value.anio=n),placeholder:"1900-2030"},null,8,["modelValue"])]),_:1}),l(e(b),null,{default:a(()=>[l(e(h),{label:"Director","label-placement":"stacked",modelValue:r.value.director,"onUpdate:modelValue":o[5]||(o[5]=n=>r.value.director=n),placeholder:"Nombre del director"},null,8,["modelValue"])]),_:1}),l(e(b),null,{default:a(()=>[l(e(h),{label:"DuraciÃ³n (min)","label-placement":"stacked",type:"number",modelValue:r.value.duracion,"onUpdate:modelValue":o[6]||(o[6]=n=>r.value.duracion=n),placeholder:"Minutos"},null,8,["modelValue"])]),_:1}),l(e(b),null,{default:a(()=>[l(e(h),{label:"ValoraciÃ³n (0-10)","label-placement":"stacked",type:"number",modelValue:r.value.valoracion,"onUpdate:modelValue":o[7]||(o[7]=n=>r.value.valoracion=n),placeholder:"0-10"},null,8,["modelValue"])]),_:1}),l(e(b),null,{default:a(()=>[l(e(h),{label:"Poster URL","label-placement":"stacked",type:"url",modelValue:r.value.poster,"onUpdate:modelValue":o[8]||(o[8]=n=>r.value.poster=n),placeholder:"https://..."},null,8,["modelValue"])]),_:1}),l(e(b),null,{default:a(()=>[l(e(h),{label:"Trailer URL","label-placement":"stacked",type:"url",modelValue:r.value.trailer,"onUpdate:modelValue":o[9]||(o[9]=n=>r.value.trailer=n),placeholder:"https://..."},null,8,["modelValue"])]),_:1})]),_:1}),l(e(y),{expand:"block",onClick:ae,class:"ion-margin-top"},{default:a(()=>[f(v(I.value?"Guardar Cambios":"Crear PelÃ­cula"),1)]),_:1})]),_:1})]),_:1},8,["is-open"]),l(e(W),{"is-open":E.value,onDidDismiss:H},{default:a(()=>[l(e(S),null,{default:a(()=>[l(e(R),null,{default:a(()=>[l(e(z),null,{default:a(()=>{var n;return[f(v((n=i.value)==null?void 0:n.titulo),1)]}),_:1}),l(e(F),{slot:"end"},{default:a(()=>[l(e(y),{onClick:H},{default:a(()=>[...o[15]||(o[15]=[f("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),i.value?(c(),g(e(G),{key:0,class:"ion-padding"},{default:a(()=>[k("div",Ne,[i.value.poster?(c(),U("img",{key:0,src:i.value.poster,alt:i.value.titulo,class:"detail-poster"},null,8,Le)):_("",!0),k("h1",null,v(i.value.titulo),1),k("div",Re,[i.value.genero?(c(),g(e($),{key:0},{default:a(()=>[l(e(N),null,{default:a(()=>[f(v(i.value.genero),1)]),_:1})]),_:1})):_("",!0),i.value.anio?(c(),g(e($),{key:1},{default:a(()=>[l(e(N),null,{default:a(()=>[f(v(i.value.anio),1)]),_:1})]),_:1})):_("",!0),i.value.duracion?(c(),g(e($),{key:2},{default:a(()=>[l(e(N),null,{default:a(()=>[f(v(i.value.duracion)+" min",1)]),_:1})]),_:1})):_("",!0),i.value.valoracion?(c(),g(e($),{key:3},{default:a(()=>[l(e(N),null,{default:a(()=>[f("â­ "+v(i.value.valoracion),1)]),_:1})]),_:1})):_("",!0)]),i.value.director?(c(),U("p",$e,[o[16]||(o[16]=k("strong",null,"Director:",-1)),f(" "+v(i.value.director),1)])):_("",!0),i.value.descripcion?(c(),U("p",Ae,v(i.value.descripcion),1)):_("",!0),i.value.trailer?(c(),g(e(y),{key:3,expand:"block",onClick:o[10]||(o[10]=n=>ne(i.value.trailer))},{default:a(()=>[l(e(M),{slot:"start",name:"play-outline"}),o[17]||(o[17]=f(" Ver Trailer ",-1))]),_:1})):_("",!0)])]),_:1})):_("",!0)]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),ze=Ce(Be,[["__scopeId","data-v-645356b9"]]);export{ze as default};
